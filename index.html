<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="2025 Fall PKU Computer Vision Final Project.">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Creating Visual Cognitive Illusions</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-PYVRSFMDRL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-PYVRSFMDRL');
  </script> -->

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="icon" href="./static/images/favicon.svg">

  <!-- Diffusion Illusion 样式 -->
  <style>
    .flip_image {
        -webkit-user-drag: none;
        user-select: none;
        -webkit-user-drag: none;
        -webkit-user-select: none;
        -moz-user-drag: none;
        -moz-user-select: none;
        -ms-user-drag: none;
        -ms-user-select: none;
        flex: 1;
        max-width: 30vw;
        max-height: 30vh;
        margin: 1vh;
        object-fit: cover;
        width: 256px;
        height: 256px;
        cursor: grab;
        animation: none;
    }

    .flip_image_animated {
        animation: flip 12s linear infinite;
    }

    @keyframes flip {
        100% { transform: rotateZ(360deg); }
        87.5%, 50% { transform: rotateZ(180deg); }
        37.5%, 0% { transform: rotateZ(0deg); }
    }

    .draggable-image {
        cursor: -webkit-grab;
        cursor: grab;
        user-select: none;
    }

    .ui-draggable-dragging {
        cursor: -webkit-grabbing;
        cursor: grabbing;
    }

    .quad-overlay {
        mix-blend-mode: multiply;
        filter: brightness(100%);
    }

    /* === 专门为第四组 QR Code 新增的样式 === */



    .hidden-character-image-container {
        display: inline-block;
        position: relative;
        margin: 0;
        border: 1px solid rgba(255, 255, 255, 0.3);
        height: 256px;
        width: 256px;
        background-color: rgba(255, 255, 255, 0.05);
    }

    .hidden-character-image {
        height: 256px;
        width: 256px;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 10;
        cursor: grab;
        border-radius: 5px;
    }

    /* Rotation Overlay styles - copied from another.html */
    .rot-image-container {
        display: inline-block;
        position: relative;
        filter: brightness(200%);
        margin: 25px;
    }

    .rot_image_size {
        max-width: 256px;
        max-height: 256px;
        width: auto;
        height: auto;
        object-fit: contain;
    }

    .quad-rotating-image {
        position: absolute;
        top: 0;
        left: 0;
        animation: quad_rotate 12s linear infinite;
        mix-blend-mode: multiply;
    }

    @keyframes quad_rotate {
        0% {
            transform: rotateZ(0deg);
        }

        12.5%,
        25% {
            transform: rotateZ(90deg);
        }

        37.5%,
        50% {
            transform: rotateZ(180deg);
        }

        62.5%,
        75% {
            transform: rotateZ(270deg);
        }

        87.5%,
        100% {
            transform: rotateZ(360deg);
        }
    }



    .ui-draggable-dragging {
        cursor: grabbing !important;
        z-index: 1000;
    }

    .row {
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        flex-direction: row;
    }

    /* For vertical stacking of demo groups */
    .demo-groups {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .lightbox {
        background-color: white !important;
        border-radius: 20px;
        max-width: 100%;
        box-shadow: 0px 0px 51px 5px rgba(255, 255, 255, 0.62);
        position: relative;
        padding: 20px;
        display: inline-block;
    }

    /* Glow hover effect - copied from another.html */
    .glow-hover-element {
        transition: box-shadow 0.1s ease-in-out;
    }

    .glow-hover-element {
        --shadow-opacity: .4;
        /* Opacity value ranging from 0 to 1 */
        --shadow-size: 15px;
        /* Base size of the shadow */
        --shadow-saturation: 400%;
        /* Saturation value ranging from 0% to 100% */
    }

    .glow-hover-element:hover {
        box-shadow:
            0 0 calc(var(--shadow-size) * 1) hsla(0, 0%, 100%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 1.5) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 2) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 2.5) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 3) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 3.5) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 4) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity));
    }

    /* Target area rectangle */
    .target-area {
        position: absolute;
        border: 2px dashed rgba(128, 128, 128, 0.5);
        background-color: rgba(128, 128, 128, 0.05);
        pointer-events: none;
        z-index: 5;
    }

    /* 外部包裹容器，负责在页面中定位 */
    .rot-hidden-outer-container {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* 核心容器：定义圆盘大小和定位基准 */
    .rot-hidden-container {
        position: relative;
        width: 280px;  /* 稍微缩小一点以适应三列布局 */
        height: 280px; /* 稍微缩小一点以适应三列布局 */
        min-width: 280px;
        min-height: 280px;
        /* 移除 aspect-ratio，直接用固定的 px 保证最稳妥的 1:1 */
        overflow: visible; /* 改为 visible，确保如果不小心有偏移也能看到整体 */
        /* 可选：如果你想看到容器中心点，可以暂时留着边框 */
        border: 1px dashed #ccc;
        background: transparent; /* 移除黑色背景，避免遮挡 */

        display: flex;
        justify-content: center;
        align-items: center;

        /* 添加此行：提高整个容器（包含底图和顶图）的亮度 */
        filter: brightness(160%);
    }

    /* 底图和旋转层样式：填满容器 */
    .rot-base-img, .rot_hidden_disk {
        width: 280px;  /* 使用固定数值而非 100% */
        height: 280px; /* 使用固定数值 */
        position: absolute;
        top: 0;
        left: 0;
        border-radius: 0;
        /* 核心修改：使用 fill。如果你确定图片原图是正方形，fill 会最准确地对齐中心 */
        object-fit: fill;
        display: block;
        margin: 0;
        padding: 0;
        /* 移除可能存在的限制 */
        max-width: none !important;
        max-height: none !important;
    }

    /* 底图特有样式 */
    .rot-base-img {
        pointer-events: none; /* 防止底图被误拖拽 */

        /* 增加底图自身的曝光度和对比度，使其在混合模式下更容易显现 */
        filter: brightness(160%) contrast(120%);
    }

    /* 旋转层特有样式 */
    .rot_hidden_disk {
        mix-blend-mode: multiply; /* 混合模式 */
        cursor: grab;
        z-index: 10;
        /* 增加亮度和对比度 */
        filter: brightness(130%) contrast(120%);
    }

    /* 专门针对旋转隐藏盘的覆盖规则 */
    .rot_hidden_disk {
        max-width: none;
        max-height: none;
        width: 280px;
        height: 280px;
        margin: 0;
    }

    /* 拖拽时的手型 */
    .rot_hidden_disk:active {
        cursor: grabbing;
    }
    /* 高亮文字样式 */
    .highlight {
        color: #ffd700; /* 金黄色 */
        font-weight: bold;
        background-color: #666; /* 灰色背景 */
        padding: 2px 6px; /* 内边距 */
        border-radius: 4px; /* 圆角 */
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>

  <!-- Diffusion Illusion JavaScript -->
  <script>
    $(function () {
        function storeOriginalPositions() {
            $('.draggable-image').each(function () {
                $(this).data('originalPosition', $(this).position());
            });
        }

        function makeImagesDraggable() {
            $('.draggable-image').draggable({
                snap: '.hidden-character-image, .lightbox',
                snapTolerance: 20,
                start: function () {
                    // Stop auto demo when dragging starts
                    if ($(this).hasClass('auto-demo-image')) {
                        stopAutoDemo();
                    }
                    $('.reset-all-rotaters-button, .reset-all-hidden-characters-button').removeClass('inactive_button');
                },
                drag: function (event, ui) {
                    var transformMatrix = $(this).css('transform');
                    ui.helper.css('transform', transformMatrix);
                },
                stop: function (event, ui) {
                    var $this = $(this);
                    var $lightbox = $this.closest('.lightbox');
                    var targetArea = $lightbox.find('.target-area');

                    if (targetArea.length > 0) {
                        var imageOffset = $this.offset();
                        var targetOffset = targetArea.offset();
                        var targetHeight = targetArea.outerHeight();
                        var imageHeight = $this.outerHeight();

                        // 1. 判断水平位置是否在虚线框范围内
                        var imageCenterX = imageOffset.left + $this.width() / 2;
                        var targetLeft = targetOffset.left;
                        var targetRight = targetOffset.left + targetArea.width();

                        if (imageCenterX >= targetLeft && imageCenterX <= targetRight) {
                            // 2. 计算吸附逻辑
                            var distanceToTop = Math.abs(imageOffset.top - targetOffset.top);
                            var distanceToBottom = Math.abs((imageOffset.top + imageHeight) - (targetOffset.top + targetHeight));

                            // 这里的 30 是吸附灵敏度（像素）
                            var snapTolerance = 30;

                            if (distanceToTop < snapTolerance || distanceToBottom < snapTolerance) {
                                // 计算图片在父容器坐标系下，为了让边缘对齐虚线框，需要设置的 top 值
                                // 公式：目标绝对top - 父容器绝对top
                                var parentOffsetTop = $this.parent().offset().top;
                                var snappedTop = targetOffset.top - parentOffsetTop;

                                $this.animate({
                                    top: snappedTop
                                }, 200);

                                console.log('Snapped to target boundary!');
                            }
                        }
                    }

                    $('.reset-all-rotaters-button, .reset-all-hidden-characters-button').removeClass('inactive_button');
                }
            }).dblclick(function () {
                var originalPosition = $(this).data('originalPosition');
                $(this).animate({
                    top: originalPosition.top,
                    left: originalPosition.left
                }, 1000);
            });
        }

        function resetHiddenCharactersPositions() {
            // Shared reset button for all groups
            $('.reset-all-hidden-characters').click(function () {
                // Reset auto demo group (group 1) - back to (0,0) and restart animation
                $('.auto-demo-image').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                // Reset manual control group (group 2 - overlay1-4)
                $('img[src*="overlay1.png"], img[src*="overlay2.png"], img[src*="overlay3.png"], img[src*="overlay4.png"]').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                // Reset geometric patterns group (group 3 - overlay5-8)
                $('img[src*="overlay5.png"], img[src*="overlay6.png"], img[src*="overlay7.png"], img[src*="overlay8.png"]').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                // Reset additional patterns group (group 4 - overlay9-12)
                $('img[src*="overlay9.png"], img[src*="overlay10.png"], img[src*="overlay11.png"], img[src*="overlay12.png"]').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                $(this).addClass('inactive_button');
                setTimeout(() => {
                    $(this).removeClass('inactive_button');
                    // Restart auto demo after reset
                    startAutoDemo();
                }, 1000);
            });
        }

        function resetFlipImagesPositions() {
            $('.reset-all-flip-images-button').click(function () {
                $('.flip_image').each(function () {
                    var originalPosition = $(this).data('originalPosition');
                    $(this).removeClass('flip_image_animated');
                    $(this).css({
                        'transform': 'rotateZ(0deg)',
                        'transition': 'transform 1s'
                    });

                    setTimeout(() => {
                        $(this).css('transition', '');
                        $(this).addClass('flip_image_animated');
                    }, 1000);
                });
                $(this).addClass('inactive_button');
            });
        }

        function initFlipImageRotation() {
            var dragging = false;
            var currentElement;
            var centerX, centerY;
            var initialAngle, currentRotation;

            function getCurrentRotation(elem) {
                var matrix = elem.css('transform');
                var angle = 0;
                if (matrix !== 'none') {
                    var values = matrix.split('(')[1].split(')')[0].split(',');
                    var a = values[0], b = values[1];
                    angle = Math.atan2(b, a) * (180 / Math.PI);
                }
                return angle;
            }

            $('.flip_image').mousedown(function (e) {
                $('.reset-all-flip-images-button').removeClass('inactive_button');
                dragging = true;
                currentElement = $(this);
                centerX = currentElement.offset().left + (currentElement.width() / 2);
                centerY = currentElement.offset().top + (currentElement.height() / 2);
                var mouseX = e.pageX, mouseY = e.pageY;
                initialAngle = Math.atan2(mouseX - centerX, mouseY - centerY);
                currentRotation = getCurrentRotation(currentElement);
                currentElement.css('cursor', 'grabbing');
                currentElement.removeClass('flip_image_animated');
            });

            $('.flip_image').dblclick(function () {
                $(this).addClass('flip_image_animated');
            });

            $(document).mouseup(function () {
                if (dragging && currentElement) {
                    currentElement.css('cursor', 'grab');
                }
                dragging = false;
            });

            $(document).mousemove(function (e) {
                if (dragging && currentElement) {
                    var mouseX = e.pageX, mouseY = e.pageY;
                    var currentAngle = Math.atan2(mouseX - centerX, mouseY - centerY);
                    var deltaAngle = initialAngle - currentAngle;
                    var newRotation = currentRotation + (deltaAngle * (180 / Math.PI));
                    currentElement.css('transform', 'rotate(' + newRotation + 'deg)');
                    currentElement.css('transform-origin', '50% 50%');
                }
            });
        }

        // 初始化函数
        storeOriginalPositions();
        makeImagesDraggable();
        resetHiddenCharactersPositions();
        resetFlipImagesPositions();
        initFlipImageRotation();

        // Initialize rotation overlay pause/play functionality
        $('.rotation-overlay-pause-button').data('state', 'pause').on('click', function () {
            var button = $(this);
            var currentState = button.data('state');

            if (currentState === 'pause') {
                button.data('state', 'play');
                button.html('Play Animation');
                $('.quad-rotating-image').css('animation-play-state', 'paused');
            } else if (currentState === 'play') {
                button.data('state', 'pause');
                button.html('Pause Animation');
                $('.quad-rotating-image').css('animation-play-state', 'running');
            }
        });


        // Initialize rotation overlay reset functionality
        $('.reset-all-rotaters-button').click(function () {
            // Reset rotation overlay images with smooth animation
            $('.quad-rotating-image').each(function () {
                // Stop animation temporarily during reset
                $(this).css('animation-play-state', 'paused');

                // Animate back to initial position and rotation
                $(this).animate({
                    top: 0,
                    left: 0
                }, 1000, function() {
                    // After position animation completes, reset rotation and restart animation
                    $(this).css({
                        'transform': 'rotateZ(0deg)',
                        'animation-play-state': 'running'
                    });
                });
            });

            // Reset pause button to initial state
            $('.rotation-overlay-pause-button').data('state', 'pause').html('Pause Animation');

            $(this).addClass('inactive_button');
        });

        // Adjust target area position based on image containers
        function adjustTargetArea() {
            var containers = $('.hidden-character-image-container');
            if (containers.length > 0) {
                var firstContainer = containers.first();
                var containerWidth = firstContainer.outerWidth();
                var containerHeight = firstContainer.outerHeight();
                var lightbox = $('.lightbox');
                var lightboxPadding = parseInt(lightbox.css('padding-left')) || 20;

                // Keep the large target area that spans all images
                var targetAreas = $('#target-area, #target-area-geo, #target-area-auto, #target-area-group4');
                var lightboxWidth = $('.lightbox').width();
                var targetAreaWidth = 1120; // Updated for 1200px lightbox (1200-80=1120)
                var centerLeft = (lightboxWidth - targetAreaWidth) / 2;

                targetAreas.css({
                    'width': targetAreaWidth + 'px',
                    'height': containerHeight + 'px',
                    'left': centerLeft + 'px',
                    'top': lightboxPadding + 'px'
                });
                console.log('Target areas set to:', targetAreaWidth, 'x', containerHeight, 'at left:', centerLeft);
            }
        }

        // Initialize automatic demo for hidden overlay group 1
        var autoDemoRunning = false;
        var autoDemoInterval;

        function startAutoDemo() {
            if (autoDemoRunning) return;
            autoDemoRunning = true;

            runAutoDemoCycle();
        }

        function runAutoDemoCycle() {
            if (!autoDemoRunning) return;

            // Get all auto demo images (group 1)
            var images = $('.auto-demo-image');

            console.log('Auto demo: Starting overlap animation');

            // Phase 1: Move each image to overlap position relative to their containers
            // Get the actual container width including margins, padding, borders
            var containerWidth = images.first().parent().outerWidth(true);
            console.log('Auto demo: Container width (including margins):', containerWidth);

            images.each(function(index) {
                // Calculate relative movement to overlap all images at center between 2nd and 3rd container
                // index 0: move right 1.5 container widths
                // index 1: move right 0.5 container widths
                // index 2: move left 0.5 container widths
                // index 3: move left 1.5 container widths
                var multiplier = 1.5 - index;
                var targetLeft = multiplier * containerWidth;
                var targetTop = 0; // Keep vertical position aligned

                console.log('Auto demo: Image', index, 'multiplier:', multiplier, 'moving to relative position:', targetLeft, targetTop);

                $(this).animate({
                    left: targetLeft,
                    top: targetTop
                }, 2000, 'swing');
            });

            // Phase 2: Wait at overlap position (4 seconds), then move back to original positions (0,0 relative to containers)
            setTimeout(function() {
                if (!autoDemoRunning) return;

                console.log('Auto demo: Moving back to original positions (0,0)');

                images.each(function(index) {
                    $(this).animate({
                        left: 0,
                        top: 0
                    }, 2000, 'swing', function() {
                        // After animation completes, schedule next cycle
                        if (autoDemoRunning) {
                            setTimeout(runAutoDemoCycle, 2000); // Wait 2 seconds before next cycle
                        }
                    });
                });
            }, 4000); // Stay overlapped for 4 seconds
        }

        function stopAutoDemo() {
            autoDemoRunning = false;
            if (autoDemoInterval) {
                clearInterval(autoDemoInterval);
            }
        }

        // Adjust target area and start auto demo after images load
        $(window).on('load', function() {
            setTimeout(function() {
                adjustTargetArea();
                startAutoDemo(); // Start the automatic overlap demo
            }, 100);
        });

        // 重置旋转圆盘的按钮逻辑
        $('.reset-all-rot-hidden').click(function () {
            $('.rot_hidden_disk').each(function () {
                // 停止动画（如果有）并重置角度
                $(this).removeClass('flip_image_animated');
                $(this).css({
                    'transform': 'rotate(0deg)',
                    'transition': 'transform 1s'
                });

                // 1秒后清除 transition 以便后续手动旋转顺畅
                setTimeout(() => {
                    $(this).css('transition', '');
                }, 1000);
            });
        });

    });
  </script>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
</head>
<body>

<!-- <nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://keunhong.com">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a>

      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          More Research
        </a>
        <div class="navbar-dropdown">
          <a class="navbar-item" href="https://hypernerf.github.io">
            HyperNeRF
          </a>
          <a class="navbar-item" href="https://nerfies.github.io">
            Nerfies
          </a>
          <a class="navbar-item" href="https://latentfusion.github.io">
            LatentFusion
          </a>
          <a class="navbar-item" href="https://photoshape.github.io">
            PhotoShape
          </a>
        </div>
      </div>
    </div>

  </div>
</nav> -->


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">Creating Visual Cognitive Illusions</h1>
          <h2 class="subtitle is-3 has-text-centered">2025 Fall PKU Computer Vision Final Project</h2>
          <div class="is-size-5 publication-authors">
            <span class="author-block">
              <a href="https://smallyang688.github.io/">Zihan Yang</a><sup>1</sup>,</span>
            <span class="author-block">
              Yuming Fang<sup>1</sup>,</span>
            <span class="author-block">
              Yueran Wang<sup>2</sup>
            </span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block"><sup>1</sup>Peking University, School of Electronics Engineering and Computer Science,</span>
            <span class="author-block"><sup>2</sup>Peking University, School of Mathematical Sciences</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/smallyang688/Creating-Visual-Cognitive-Illusions"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
              <span class="link-block">
                <a href="./report/report.pdf" target="_blank"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                  </a>
              </span>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<section class="section" style="padding-top: 0.25rem;">
  <div class="container is-max-desktop">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
        </div>
      </div>
    </div>
    <!--/ Abstract. -->

    <!-- Interactive Demos. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Interactive Demos</h2>

        <!-- Flip Illusion Demo -->
        <h3 class="title is-4">Flip Illusion</h3>
        <p><strong class="highlight">Click and drag to rotate, double-click to reset!</strong></p>
        <div style="text-align: center; margin: 20px 0;">
          <button class="reset-all-flip-images-button button is-primary">Reset All Rotations</button>
        </div>
        <div class="columns is-centered">
          <div class="column is-one-third">
            <div class="image-container" style="text-align: center;">
              <img src="./static/images/flip1.jpg" class="flip_image flip_image_animated glow-hover-element" style="max-width: 200px; max-height: 200px;">
            </div>
            <div class="caption" style="text-align: center; margin-top: 10px;">
              giraffe/penguin
            </div>
          </div>
          <div class="column is-one-third">
            <div class="image-container" style="text-align: center;">
              <img src="./static/images/flip2.jpg" class="flip_image flip_image_animated glow-hover-element" style="max-width: 200px; max-height: 200px;">
            </div>
            <div class="caption" style="text-align: center; margin-top: 10px;">
              ship/ship
            </div>
          </div>
          <div class="column is-one-third">
            <div class="image-container" style="text-align: center;">
              <img src="./static/images/flip3.jpg" class="flip_image flip_image_animated glow-hover-element" style="max-width: 200px; max-height: 200px;">
            </div>
            <div class="caption" style="text-align: center; margin-top: 10px;">
              dress/dress
            </div>
          </div>
        </div>

        <!-- Rotation Overlay Demo -->
        <h3 class="title is-4" style="margin-top: 2rem;">Rotation Overlay Illusion</h3>
        <p><strong class="highlight">Click and drag to rotate the top image. Watch how the combined image changes!</strong></p>
        <div style="text-align: center; margin: 20px 0;">
          <button class="reset-all-rotaters-button button is-primary" style="margin-right: 10px;">Reset All Positions</button>
          <button class="rotation-overlay-pause-button button is-warning">Pause Animation</button>
        </div>
        <div class="columns is-centered" style="gap: 40px;">
          <div class="column is-one-third">
            <div class="rot-image-container" style="filter: brightness(200%);">
              <img src="./static/images/rot_base_1.png" class="rot_image_size">
              <img src="./static/images/rot_overlay_1.png" class="rot_image_size quad-rotating-image draggable-image glow-hover-element">
            </div>
          </div>
          <div class="column is-one-third">
            <div class="rot-image-container" style="filter: brightness(150%);">
              <img src="./static/images/rot_base_2.png" class="rot_image_size">
              <img src="./static/images/rot_overlay_2.png" class="rot_image_size quad-rotating-image draggable-image glow-hover-element">
            </div>
          </div>
          <div class="column is-one-third">
            <div class="rot-image-container" style="filter: brightness(180%);">
              <img src="./static/images/rot_base_3.png" class="rot_image_size">
              <img src="./static/images/rot_overlay_3.png" class="rot_image_size quad-rotating-image draggable-image glow-hover-element">
            </div>
          </div>
        </div>

        <!-- Hidden Overlay Demo -->
        <h3 class="title is-4" style="margin-top: 2rem;">Hidden Overlay Illusion</h3>
        <p style="text-align: center; margin-bottom: 1rem; color: #666;"><strong class="highlight">Drag multiple transparent images together to reveal a hidden pattern underneath!</strong></p>

        <!-- Reset button moved here -->
        <div style="text-align: center; margin-bottom: 2rem;">
          <button class="reset-all-hidden-characters button is-primary">Reset All Positions</button>
        </div>

        <div class="demo-groups">
        <!-- Group 1: Automatic overlap demo -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area-auto" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap1.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap2.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap3.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap4.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
          </div>
        </div>

        <!-- Group 2: Manual drag demo -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <!-- Glow effect box -->
          <div class="glow-effect" id="glow-effect"></div>

          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay1.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay2.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay3.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay4.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
          </div>
        </div>

        <!-- Group 3: New geometric patterns -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area-geo" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay5.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay6.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay7.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay8.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
          </div>
        </div>

        <!-- Group 4: Additional patterns -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area-group4" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay9.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay10.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay11.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay12.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
          </div>
        </div>

        <div class="caption" style="text-align: center; margin-top: 10px;">
          Scan it!
        </div>

        </div>
      </div>
    </div>
    <!--/ Interactive Demos. -->
  </div>
</section>

<!-- Rotational Hidden Overlay Demo -->
<section class="section">
  <div class="container is-max-desktop has-text-centered">
    <h3 class="title is-4" style="margin-top: 2rem;">Rotational Hidden Overlay</h3>
    <p><strong class="highlight">Drag to rotate the top disk. Align it to the correct angle to reveal the secret!</strong></p>

    <div style="margin: 20px 0;">
      <button class="reset-all-rot-hidden button is-primary">Reset All Disks</button>
    </div>

    <div class="columns is-centered is-mobile" style="gap: 20px;">

      <div class="column is-one-third" style="padding: 10px;">
        <div class="rot-hidden-outer-container" style="width: 280px; flex-direction: column; align-items: center; display: flex;">
          <div class="rot-hidden-container">
            <img src="./static/images/rot_hidden_base_1.png" class="rot-base-img">
            <img src="./static/images/rot_hidden_overlay_1.png" class="rot_hidden_disk flip_image glow-hover-element">
          </div>
          <div class="caption" style="text-align: center; margin-top: 15px; width: 100%;">
            You can find three angles that reveal 'PKU', 'EECS', and 'SMS' respectively.
          </div>
        </div>
      </div>

      <div class="column is-one-third" style="padding: 10px;">
        <div class="rot-hidden-outer-container" style="width: 280px; flex-direction: column; align-items: center; display: flex;">
          <div class="rot-hidden-container">
            <img src="./static/images/rot_hidden_base_2.png" class="rot-base-img">
            <img src="./static/images/rot_hidden_overlay_2.png" class="rot_hidden_disk flip_image glow-hover-element">
          </div>
          <div class="caption" style="text-align: center; margin-top: 15px; width: 100%;">
            You can find one angle that reveals a heart and the letters 'LOVE'.
          </div>
        </div>
      </div>

      <div class="column is-one-third" style="padding: 10px;">
        <div class="rot-hidden-outer-container" style="width: 280px; flex-direction: column; align-items: center; display: flex;">
          <div class="rot-hidden-container">
            <img src="./static/images/rot_hidden_base_3.png" class="rot-base-img">
            <img src="./static/images/rot_hidden_overlay_3.png" class="rot_hidden_disk flip_image glow-hover-element">
          </div>
          <div class="caption" style="text-align: center; margin-top: 15px; width: 100%;">
            You can find one angle that reveals a cup.
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop has-text-centered">
    <h2 class="title is-3">Orthogonal Voxel Projection Synthesis</h2>
    <p style="margin-bottom: 2rem;">
      <strong class="highlight">A 3D voxel structure that projects different semantic objects from three orthogonal views.</strong>
    </p>

    <div class="columns is-centered">
      <div class="column is-full">
        <div id="voxel-container" style="width: 100%; height: 500px; background-color: #f0f0f0; border-radius: 10px; position: relative; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            <div id="loading-text" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666;">Loading 3D Model...</div>
        </div>
        <div class="caption" style="margin-top: 10px;">
          Interactive 3D Viewer (Click and drag to rotate, scroll to zoom)
        </div>
      </div>
    </div>

    <h4 class="title is-5" style="margin-top: 2rem;">Orthogonal Views</h4>
    <div class="columns is-centered is-mobile" style="gap: 20px;">

      <div class="column is-one-third">
        <div class="image-container" style="border: 1px solid #ddd; padding: 5px; background: white; border-radius: 8px;">
          <img src="./static/images/butterfly.png" style="width: 100%; height: auto; display: block;">
        </div>
        <div class="caption" style="margin-top: 10px; font-weight: bold;">
          Front View: Butterfly
        </div>
      </div>

      <div class="column is-one-third">
        <div class="image-container" style="border: 1px solid #ddd; padding: 5px; background: white; border-radius: 8px;">
           <img src="./static/images/tree.png" style="width: 100%; height: auto; display: block;">
        </div>
        <div class="caption" style="margin-top: 10px; font-weight: bold;">
          Side View: Tree
        </div>
      </div>

      <div class="column is-one-third">
        <div class="image-container" style="border: 1px solid #ddd; padding: 5px; background: white; border-radius: 8px;">
           <img src="./static/images/apple.png" style="width: 100%; height: auto; display: block;">
        </div>
        <div class="caption" style="margin-top: 10px; font-weight: bold;">
          Top View: Apple
        </div>
      </div>

    </div>
  </div>
</section>

<section class="section" id="BibTeX">
  <div class="container is-max-desktop content">
    <h2 class="title">BibTeX</h2>
    <pre><code>@article{diffusion illusion
  author    = {Zihan Yang, Yuming Fang, Yueran Wang},
  title     = {Creating Visual Cognitive Illusions},
  journal   = {PKU Computer Vision Final Project},
  year      = {2025},
}</code></pre>
  </div>
</section>


<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <a class="icon-link"
         href="https://arxiv.org/pdf/2312.03817">
        <i class="fas fa-file-pdf"></i>
      </a>
      <a class="icon-link" href="https://github.com/RyannDaGreat/Diffusion-Illusions" class="external-link">
        <i class="fab fa-github"></i>
      </a>
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>
          <p>
            This means you are free to borrow the <a
              href="https://github.com/nerfies/nerfies.github.io">source code</a> of this website,
            we just ask that you link back to this page in the footer.
            Please remember to remove the analytics code included in the header of the website which
            you do not want on your website.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

<script type="module">
    import * as THREE from 'three';
    // 引入 ArcballControls (全向旋转控制器)
    import { ArcballControls } from 'three/addons/controls/ArcballControls.js';
    import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';

    function init3DViewer() {
        const container = document.getElementById('voxel-container');
        if (!container) return;

        // 1. 创建场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0); // 浅灰色背景

        // 2. 创建相机
        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(50, 50, 50); // 设置相机初始位置

        // 3. 创建渲染器
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        // 4. 添加控制器 (改为 ArcballControls 以消除死角)
        // 注意：ArcballControls 需要传入 scene，因为它默认会带一个辅助圈(Gizmo)
        const controls = new ArcballControls(camera, renderer.domElement, scene);

        // 隐藏默认的彩色控制圈 (Gizmo)，保持画面干净
        controls.setGizmosVisible(false);

        // 设置阻尼，让旋转有惯性，手感更好
        controls.enableAnimations = true;
        controls.dampingFactor = 10; // Arcball 的阻尼系数算法不同，通常要在 5-20 之间
        controls.wMax = 12; // 旋转灵敏度限制

        // 5. 改进灯光系统 (Studio Lighting)
        // 半球光：模拟天空光 (白色) 和地面反光 (深灰)，这能让模型阴影部分也有细节
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
        hemiLight.position.set(0, 20, 0);
        scene.add(hemiLight);

        // 主光源：强光，制造高光和阴影
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
        dirLight.position.set(50, 50, 50); // 从侧上方打光
        scene.add(dirLight);

        // 轮廓光/补光：照亮背面，防止死黑
        const backLight = new THREE.DirectionalLight(0xffffff, 0.5);
        backLight.position.set(-50, -20, -50);
        scene.add(backLight);

        // 6. 加载 OBJ 模型
        const loader = new OBJLoader();
        // === 请修改这里的路径为你的 obj 文件路径 ===
        loader.load(
            './static/models/voxel.obj',
            function (object) {
                // 加载成功的回调
                const loadingText = document.getElementById('loading-text');
                if (loadingText) loadingText.style.display = 'none';

                // 1. 给模型加上材质 (修改为白模风格)
                object.traverse(function (child) {
                    if (child.isMesh) {
                        // 使用 Standard 材质，这种材质配合上面的灯光效果最好
                        child.material = new THREE.MeshStandardMaterial({
                            color: 0xdddddd,  // 浅灰色 (比纯白好，不容易过曝)
                            roughness: 0.6,   // 粗糙度：0.6 像粘土/石膏
                            metalness: 0.1,   // 金属度：很低，避免像镜子
                            flatShading: true, // 关键：保留体素的棱角感
                            side: THREE.DoubleSide
                        });
                    }
                });

                // 2. 计算模型的包围盒
                const box = new THREE.Box3().setFromObject(object);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());

                // 3. 居中模型：把模型移动到世界坐标原点 (0,0,0)
                // 逻辑：将模型的当前位置减去它的中心点偏移量
                object.position.x = -center.x;
                object.position.y = -center.y;
                object.position.z = -center.z;

                // 将修正后的模型添加到场景
                // 此时模型的视觉中心就在 (0,0,0) 了
                scene.add(object);

                // 4. 自动调整相机距离 (修复了之前的数学错误)
                const maxDim = Math.max(size.x, size.y, size.z);
                const fov = camera.fov * (Math.PI / 180);

                // 计算相机距离：让模型最大的一边刚好撑满视野
                // 公式：distance = (size / 2) / tan(fov / 2)
                let cameraDist = (maxDim / 2) / Math.tan(fov / 2);

                // 乘以一个系数稍微拉远一点，留点边距
                cameraDist *= 2.0;

                // 设置相机位置
                camera.position.set(cameraDist, cameraDist, cameraDist);

                // 5. 关键：相机和控制器都必须看向原点 (0,0,0)
                // 因为我们已经在第3步把模型移到 (0,0,0) 了
                camera.lookAt(0, 0, 0);
                controls.target.set(0, 0, 0);

                controls.update();
            },
            function (xhr) {
                // 加载进度
                console.log((xhr.loaded / xhr.total * 100) + '% loaded');
            },
            function (error) {
                // 错误处理
                console.error('An error happened loading the OBJ:', error);
                const loadingText = document.getElementById('loading-text');
                if (loadingText) loadingText.innerText = 'Error: ' + error.message;
            }
        );

        // 7. 动画循环
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // 8. 窗口大小改变时自动调整
        window.addEventListener('resize', onWindowResize, false);
        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
    }

    // 页面加载完成后启动
    init3DViewer();
</script>

</body>
</html>
