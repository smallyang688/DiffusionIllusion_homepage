<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="2025 Fall PKU Computer Vision Final Project.">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Creating Visual Cognitive Illusions</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-PYVRSFMDRL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-PYVRSFMDRL');
  </script> -->

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="icon" href="./static/images/favicon.svg">

  <!-- Diffusion Illusion æ ·å¼ -->
  <style>
    .flip_image {
        -webkit-user-drag: none;
        user-select: none;
        -webkit-user-drag: none;
        -webkit-user-select: none;
        -moz-user-drag: none;
        -moz-user-select: none;
        -ms-user-drag: none;
        -ms-user-select: none;
        flex: 1;
        max-width: 30vw;
        max-height: 30vh;
        margin: 1vh;
        object-fit: cover;
        width: 256px;
        height: 256px;
        cursor: grab;
        animation: none;
    }

    .flip_image_animated {
        animation: flip 12s linear infinite;
    }

    @keyframes flip {
        100% { transform: rotateZ(360deg); }
        87.5%, 50% { transform: rotateZ(180deg); }
        37.5%, 0% { transform: rotateZ(0deg); }
    }

    .draggable-image {
        cursor: -webkit-grab;
        cursor: grab;
        user-select: none;
    }

    .ui-draggable-dragging {
        cursor: -webkit-grabbing;
        cursor: grabbing;
    }

    .quad-overlay {
        mix-blend-mode: multiply;
        filter: brightness(100%);
    }

    /* === ä¸“é—¨ä¸ºç¬¬å››ç»„ QR Code æ–°å¢çš„æ ·å¼ === */



    .hidden-character-image-container {
        display: inline-block;
        position: relative;
        margin: 0;
        border: 1px solid rgba(255, 255, 255, 0.3);
        height: 256px;
        width: 256px;
        background-color: rgba(255, 255, 255, 0.05);
    }

    .hidden-character-image {
        height: 256px;
        width: 256px;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 10;
        cursor: grab;
        border-radius: 5px;
    }

    /* Rotation Overlay styles - copied from another.html */
    .rot-image-container {
        display: inline-block;
        position: relative;
        filter: brightness(200%);
        margin: 25px;
    }

    .rot_image_size {
        max-width: 256px;
        max-height: 256px;
        width: auto;
        height: auto;
        object-fit: contain;
    }

    .quad-rotating-image {
        position: absolute;
        top: 0;
        left: 0;
        animation: quad_rotate 12s linear infinite;
        mix-blend-mode: multiply;
    }

    @keyframes quad_rotate {
        0% {
            transform: rotateZ(0deg);
        }

        12.5%,
        25% {
            transform: rotateZ(90deg);
        }

        37.5%,
        50% {
            transform: rotateZ(180deg);
        }

        62.5%,
        75% {
            transform: rotateZ(270deg);
        }

        87.5%,
        100% {
            transform: rotateZ(360deg);
        }
    }



    .ui-draggable-dragging {
        cursor: grabbing !important;
        z-index: 1000;
    }

    .row {
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        flex-direction: row;
    }

    /* For vertical stacking of demo groups */
    .demo-groups {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .lightbox {
        background-color: white !important;
        border-radius: 20px;
        max-width: 100%;
        box-shadow: 0px 0px 51px 5px rgba(255, 255, 255, 0.62);
        position: relative;
        padding: 20px;
        display: inline-block;
    }

    /* Glow hover effect - copied from another.html */
    .glow-hover-element {
        transition: box-shadow 0.1s ease-in-out;
    }

    .glow-hover-element {
        --shadow-opacity: .4;
        /* Opacity value ranging from 0 to 1 */
        --shadow-size: 15px;
        /* Base size of the shadow */
        --shadow-saturation: 400%;
        /* Saturation value ranging from 0% to 100% */
    }

    .glow-hover-element:hover {
        box-shadow:
            0 0 calc(var(--shadow-size) * 1) hsla(0, 0%, 100%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 1.5) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 2) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 2.5) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 3) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 3.5) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity)),
            0 0 calc(var(--shadow-size) * 4) hsla(330, var(--shadow-saturation), 62%, var(--shadow-opacity));
    }

    /* Target area rectangle */
    .target-area {
        position: absolute;
        border: 2px dashed rgba(128, 128, 128, 0.5);
        background-color: rgba(128, 128, 128, 0.05);
        pointer-events: none;
        z-index: 5;
    }

    /* å¤–éƒ¨åŒ…è£¹å®¹å™¨ï¼Œè´Ÿè´£åœ¨é¡µé¢ä¸­å®šä½ */
    .rot-hidden-outer-container {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* æ ¸å¿ƒå®¹å™¨ï¼šå®šä¹‰åœ†ç›˜å¤§å°å’Œå®šä½åŸºå‡† */
    .rot-hidden-container {
        position: relative;
        width: 280px;  /* ç¨å¾®ç¼©å°ä¸€ç‚¹ä»¥é€‚åº”ä¸‰åˆ—å¸ƒå±€ */
        height: 280px; /* ç¨å¾®ç¼©å°ä¸€ç‚¹ä»¥é€‚åº”ä¸‰åˆ—å¸ƒå±€ */
        min-width: 280px;
        min-height: 280px;
        /* ç§»é™¤ aspect-ratioï¼Œç›´æ¥ç”¨å›ºå®šçš„ px ä¿è¯æœ€ç¨³å¦¥çš„ 1:1 */
        overflow: visible; /* æ”¹ä¸º visibleï¼Œç¡®ä¿å¦‚æœä¸å°å¿ƒæœ‰åç§»ä¹Ÿèƒ½çœ‹åˆ°æ•´ä½“ */
        /* å¯é€‰ï¼šå¦‚æœä½ æƒ³çœ‹åˆ°å®¹å™¨ä¸­å¿ƒç‚¹ï¼Œå¯ä»¥æš‚æ—¶ç•™ç€è¾¹æ¡† */
        border: 1px dashed #ccc;
        background: transparent; /* ç§»é™¤é»‘è‰²èƒŒæ™¯ï¼Œé¿å…é®æŒ¡ */

        display: flex;
        justify-content: center;
        align-items: center;

        /* æ·»åŠ æ­¤è¡Œï¼šæé«˜æ•´ä¸ªå®¹å™¨ï¼ˆåŒ…å«åº•å›¾å’Œé¡¶å›¾ï¼‰çš„äº®åº¦ */
        filter: brightness(160%);
    }

    /* åº•å›¾å’Œæ—‹è½¬å±‚æ ·å¼ï¼šå¡«æ»¡å®¹å™¨ */
    .rot-base-img, .rot_hidden_disk {
        width: 280px;  /* ä½¿ç”¨å›ºå®šæ•°å€¼è€Œé 100% */
        height: 280px; /* ä½¿ç”¨å›ºå®šæ•°å€¼ */
        position: absolute;
        top: 0;
        left: 0;
        border-radius: 0;
        /* æ ¸å¿ƒä¿®æ”¹ï¼šä½¿ç”¨ fillã€‚å¦‚æœä½ ç¡®å®šå›¾ç‰‡åŸå›¾æ˜¯æ­£æ–¹å½¢ï¼Œfill ä¼šæœ€å‡†ç¡®åœ°å¯¹é½ä¸­å¿ƒ */
        object-fit: fill;
        display: block;
        margin: 0;
        padding: 0;
        /* ç§»é™¤å¯èƒ½å­˜åœ¨çš„é™åˆ¶ */
        max-width: none !important;
        max-height: none !important;
    }

    /* åº•å›¾ç‰¹æœ‰æ ·å¼ */
    .rot-base-img {
        pointer-events: none; /* é˜²æ­¢åº•å›¾è¢«è¯¯æ‹–æ‹½ */

        /* å¢åŠ åº•å›¾è‡ªèº«çš„æ›å…‰åº¦å’Œå¯¹æ¯”åº¦ï¼Œä½¿å…¶åœ¨æ··åˆæ¨¡å¼ä¸‹æ›´å®¹æ˜“æ˜¾ç° */
        filter: brightness(160%) contrast(120%);
    }

    /* æ—‹è½¬å±‚ç‰¹æœ‰æ ·å¼ */
    .rot_hidden_disk {
        mix-blend-mode: multiply; /* æ··åˆæ¨¡å¼ */
        cursor: grab;
        z-index: 10;
        /* å¢åŠ äº®åº¦å’Œå¯¹æ¯”åº¦ */
        filter: brightness(130%) contrast(120%);
    }

    /* ä¸“é—¨é’ˆå¯¹æ—‹è½¬éšè—ç›˜çš„è¦†ç›–è§„åˆ™ */
    .rot_hidden_disk {
        max-width: none;
        max-height: none;
        width: 280px;
        height: 280px;
        margin: 0;
    }

    /* æ‹–æ‹½æ—¶çš„æ‰‹å‹ */
    .rot_hidden_disk:active {
        cursor: grabbing;
    }
    /* é«˜äº®æ–‡å­—æ ·å¼ */
    .highlight {
        color: #ffd700; /* é‡‘é»„è‰² */
        font-weight: bold;
        background-color: #666; /* ç°è‰²èƒŒæ™¯ */
        padding: 2px 6px; /* å†…è¾¹è· */
        border-radius: 4px; /* åœ†è§’ */
    }

    /* === Hybrid Image Gallery Styles (New) === */

    /* å¤–éƒ¨å®¹å™¨ï¼šåŒ…å«ç¼©ç•¥å›¾æ å’Œæ¼”ç¤ºèˆå° */
    .hybrid-gallery-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
    }

    /* 1. ç¼©ç•¥å›¾æ  */
    .hybrid-thumbnails {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 10px;
    }

    .hybrid-thumb {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid transparent;
        opacity: 0.6;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    /* é€‰ä¸­çŠ¶æ€çš„ç¼©ç•¥å›¾ */
    .hybrid-thumb.active {
        border-color: #3273dc; /* è“è‰²é«˜äº®è¾¹æ¡† */
        opacity: 1;
        transform: scale(1.1);
        box-shadow: 0 0 8px rgba(50, 115, 220, 0.5);
    }

    /* 2. æ¼”ç¤ºèˆå°ï¼šç”¨äºæ”¾æ˜ åŠ¨ç”» */
    .hybrid-stage {
        width: 100%;
        height: 500px; /* å›ºå®šé«˜åº¦ */
        background-color: #fcfcfc;
        border: 1px solid #eee;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
    }

    /* èˆå°ä¸­å¿ƒçš„å›¾ç‰‡ */
    .hybrid-stage-img {
        max-width: 90%;
        max-height: 80%;
        width: auto;
        height: auto;
        transition: transform 3s ease-in-out, filter 3s ease-in-out;
        will-change: transform, filter;
    }

    /* çŠ¶æ€ A: è¿‘çœ‹ (æ”¾å¤§ï¼Œæ¸…æ™°) */
    .view-near {
        transform: scale(1);
        filter: blur(0px);
    }

    /* çŠ¶æ€ B: è¿œçœ‹ (ç¼©å°ï¼Œæ¨¡ç³Š) */
    .view-far {
        transform: scale(0.1); /* ç¼©å¾—å¾ˆå° */
        filter: blur(0.5px);   /* ç¨å¾®æ¨¡ç³Šå»å™ª */
    }

    /* 3. åŠ¨æ€å­—å¹• */
    .hybrid-caption-box {
        position: absolute;
        bottom: 30px;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 8px 16px;
        border-radius: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        font-weight: bold;
        color: #333;
        transition: opacity 0.5s ease;
        text-align: center;
    }

    .caption-highlight {
        color: #3273dc;
    }

    /* === Manual Hybrid Control Styles === */
    .manual-control-box {
        margin-top: 40px;
        padding: 30px;
        background: #f8f9fa;
        border-radius: 15px;
        border: 1px solid #e9ecef;
    }

    .manual-slider-container {
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    /* è‡ªå®šä¹‰æ»‘å—æ ·å¼ */
    input[type=range].hybrid-slider {
        -webkit-appearance: none;
        width: 100%;
        height: 8px;
        background: #d3d3d3;
        outline: none;
        border-radius: 5px;
        transition: opacity .2s;
    }

    input[type=range].hybrid-slider:hover {
        opacity: 1;
    }

    input[type=range].hybrid-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        background: #3273dc;
        cursor: pointer;
        border-radius: 50%;
    }

    input[type=range].hybrid-slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        background: #3273dc;
        cursor: pointer;
        border-radius: 50%;
    }

    .manual-image-container {
        height: 500px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        background-color: white;
        border-radius: 8px;
        border: 1px solid #ddd;
        margin-top: 20px;
    }

    #manual-hybrid-img {
        transition: transform 0.1s linear, filter 0.1s linear; /* å¿«é€Ÿå“åº” */
        max-width: 90%;
        max-height: 90%;
    }

    /* æ‰‹åŠ¨æ¨¡å¼çš„é€‰æ‹©æŒ‰é’® */
    .manual-selector-btn {
        margin: 0 5px;
        opacity: 0.6;
        transition: opacity 0.3s;
    }
    .manual-selector-btn.is-active {
        opacity: 1;
        border-color: #3273dc;
        box-shadow: 0 0 5px rgba(50, 115, 220, 0.5);
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>

  <!-- Diffusion Illusion JavaScript -->
  <script>
    $(function () {
        function storeOriginalPositions() {
            $('.draggable-image').each(function () {
                $(this).data('originalPosition', $(this).position());
            });
        }

        function makeImagesDraggable() {
            $('.draggable-image').draggable({
                snap: '.hidden-character-image, .lightbox',
                snapTolerance: 20,
                start: function () {
                    // Stop auto demo when dragging starts
                    if ($(this).hasClass('auto-demo-image')) {
                        stopAutoDemo();
                    }
                    $('.reset-all-rotaters-button, .reset-all-hidden-characters-button').removeClass('inactive_button');
                },
                drag: function (event, ui) {
                    var transformMatrix = $(this).css('transform');
                    ui.helper.css('transform', transformMatrix);
                },
                stop: function (event, ui) {
                    var $this = $(this);
                    var $lightbox = $this.closest('.lightbox');
                    var targetArea = $lightbox.find('.target-area');

                    if (targetArea.length > 0) {
                        var imageOffset = $this.offset();
                        var targetOffset = targetArea.offset();
                        var targetHeight = targetArea.outerHeight();
                        var imageHeight = $this.outerHeight();

                        // 1. åˆ¤æ–­æ°´å¹³ä½ç½®æ˜¯å¦åœ¨è™šçº¿æ¡†èŒƒå›´å†…
                        var imageCenterX = imageOffset.left + $this.width() / 2;
                        var targetLeft = targetOffset.left;
                        var targetRight = targetOffset.left + targetArea.width();

                        if (imageCenterX >= targetLeft && imageCenterX <= targetRight) {
                            // 2. è®¡ç®—å¸é™„é€»è¾‘
                            var distanceToTop = Math.abs(imageOffset.top - targetOffset.top);
                            var distanceToBottom = Math.abs((imageOffset.top + imageHeight) - (targetOffset.top + targetHeight));

                            // è¿™é‡Œçš„ 30 æ˜¯å¸é™„çµæ•åº¦ï¼ˆåƒç´ ï¼‰
                            var snapTolerance = 30;

                            if (distanceToTop < snapTolerance || distanceToBottom < snapTolerance) {
                                // è®¡ç®—å›¾ç‰‡åœ¨çˆ¶å®¹å™¨åæ ‡ç³»ä¸‹ï¼Œä¸ºäº†è®©è¾¹ç¼˜å¯¹é½è™šçº¿æ¡†ï¼Œéœ€è¦è®¾ç½®çš„ top å€¼
                                // å…¬å¼ï¼šç›®æ ‡ç»å¯¹top - çˆ¶å®¹å™¨ç»å¯¹top
                                var parentOffsetTop = $this.parent().offset().top;
                                var snappedTop = targetOffset.top - parentOffsetTop;

                                $this.animate({
                                    top: snappedTop
                                }, 200);

                                console.log('Snapped to target boundary!');
                            }
                        }
                    }

                    $('.reset-all-rotaters-button, .reset-all-hidden-characters-button').removeClass('inactive_button');
                }
            }).dblclick(function () {
                var originalPosition = $(this).data('originalPosition');
                $(this).animate({
                    top: originalPosition.top,
                    left: originalPosition.left
                }, 1000);
            });
        }

        function resetHiddenCharactersPositions() {
            // Shared reset button for all groups
            $('.reset-all-hidden-characters').click(function () {
                // Reset auto demo group (group 1) - back to (0,0) and restart animation
                $('.auto-demo-image').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                // Reset manual control group (group 2 - overlay1-4)
                $('img[src*="overlay1.png"], img[src*="overlay2.png"], img[src*="overlay3.png"], img[src*="overlay4.png"]').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                // Reset geometric patterns group (group 3 - overlay5-8)
                $('img[src*="overlay5.png"], img[src*="overlay6.png"], img[src*="overlay7.png"], img[src*="overlay8.png"]').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                // Reset additional patterns group (group 4 - overlay9-12)
                $('img[src*="overlay9.png"], img[src*="overlay10.png"], img[src*="overlay11.png"], img[src*="overlay12.png"]').each(function () {
                    $(this).animate({
                        top: 0,
                        left: 0
                    }, 1000);
                });

                $(this).addClass('inactive_button');
                setTimeout(() => {
                    $(this).removeClass('inactive_button');
                    // Restart auto demo after reset
                    startAutoDemo();
                }, 1000);
            });
        }

        function resetFlipImagesPositions() {
            $('.reset-all-flip-images-button').click(function () {
                $('.flip_image').each(function () {
                    var originalPosition = $(this).data('originalPosition');
                    $(this).removeClass('flip_image_animated');
                    $(this).css({
                        'transform': 'rotateZ(0deg)',
                        'transition': 'transform 1s'
                    });

                    setTimeout(() => {
                        $(this).css('transition', '');
                        $(this).addClass('flip_image_animated');
                    }, 1000);
                });
                $(this).addClass('inactive_button');
            });
        }

        function initFlipImageRotation() {
            var dragging = false;
            var currentElement;
            var centerX, centerY;
            var initialAngle, currentRotation;

            function getCurrentRotation(elem) {
                var matrix = elem.css('transform');
                var angle = 0;
                if (matrix !== 'none') {
                    var values = matrix.split('(')[1].split(')')[0].split(',');
                    var a = values[0], b = values[1];
                    angle = Math.atan2(b, a) * (180 / Math.PI);
                }
                return angle;
            }

            $('.flip_image').mousedown(function (e) {
                $('.reset-all-flip-images-button').removeClass('inactive_button');
                dragging = true;
                currentElement = $(this);
                centerX = currentElement.offset().left + (currentElement.width() / 2);
                centerY = currentElement.offset().top + (currentElement.height() / 2);
                var mouseX = e.pageX, mouseY = e.pageY;
                initialAngle = Math.atan2(mouseX - centerX, mouseY - centerY);
                currentRotation = getCurrentRotation(currentElement);
                currentElement.css('cursor', 'grabbing');
                currentElement.removeClass('flip_image_animated');
            });

            $('.flip_image').dblclick(function () {
                $(this).addClass('flip_image_animated');
            });

            $(document).mouseup(function () {
                if (dragging && currentElement) {
                    currentElement.css('cursor', 'grab');
                }
                dragging = false;
            });

            $(document).mousemove(function (e) {
                if (dragging && currentElement) {
                    var mouseX = e.pageX, mouseY = e.pageY;
                    var currentAngle = Math.atan2(mouseX - centerX, mouseY - centerY);
                    var deltaAngle = initialAngle - currentAngle;
                    var newRotation = currentRotation + (deltaAngle * (180 / Math.PI));
                    currentElement.css('transform', 'rotate(' + newRotation + 'deg)');
                    currentElement.css('transform-origin', '50% 50%');
                }
            });
        }

        // åˆå§‹åŒ–å‡½æ•°
        storeOriginalPositions();
        makeImagesDraggable();
        resetHiddenCharactersPositions();
        resetFlipImagesPositions();
        initFlipImageRotation();

        // Initialize rotation overlay pause/play functionality
        $('.rotation-overlay-pause-button').data('state', 'pause').on('click', function () {
            var button = $(this);
            var currentState = button.data('state');

            if (currentState === 'pause') {
                button.data('state', 'play');
                button.html('Play Animation');
                $('.quad-rotating-image').css('animation-play-state', 'paused');
            } else if (currentState === 'play') {
                button.data('state', 'pause');
                button.html('Pause Animation');
                $('.quad-rotating-image').css('animation-play-state', 'running');
            }
        });


        // Initialize rotation overlay reset functionality
        $('.reset-all-rotaters-button').click(function () {
            // Reset rotation overlay images with smooth animation
            $('.quad-rotating-image').each(function () {
                // Stop animation temporarily during reset
                $(this).css('animation-play-state', 'paused');

                // Animate back to initial position and rotation
                $(this).animate({
                    top: 0,
                    left: 0
                }, 1000, function() {
                    // After position animation completes, reset rotation and restart animation
                    $(this).css({
                        'transform': 'rotateZ(0deg)',
                        'animation-play-state': 'running'
                    });
                });
            });

            // Reset pause button to initial state
            $('.rotation-overlay-pause-button').data('state', 'pause').html('Pause Animation');

            $(this).addClass('inactive_button');
        });

        // Adjust target area position based on image containers
        function adjustTargetArea() {
            var containers = $('.hidden-character-image-container');
            if (containers.length > 0) {
                var firstContainer = containers.first();
                var containerWidth = firstContainer.outerWidth();
                var containerHeight = firstContainer.outerHeight();
                var lightbox = $('.lightbox');
                var lightboxPadding = parseInt(lightbox.css('padding-left')) || 20;

                // Keep the large target area that spans all images
                var targetAreas = $('#target-area, #target-area-geo, #target-area-auto, #target-area-group4');
                var lightboxWidth = $('.lightbox').width();
                var targetAreaWidth = 1120; // Updated for 1200px lightbox (1200-80=1120)
                var centerLeft = (lightboxWidth - targetAreaWidth) / 2;

                targetAreas.css({
                    'width': targetAreaWidth + 'px',
                    'height': containerHeight + 'px',
                    'left': centerLeft + 'px',
                    'top': lightboxPadding + 'px'
                });
                console.log('Target areas set to:', targetAreaWidth, 'x', containerHeight, 'at left:', centerLeft);
            }
        }

        // Initialize automatic demo for hidden overlay group 1
        var autoDemoRunning = false;
        var autoDemoInterval;

        function startAutoDemo() {
            if (autoDemoRunning) return;
            autoDemoRunning = true;

            runAutoDemoCycle();
        }

        function runAutoDemoCycle() {
            if (!autoDemoRunning) return;

            // Get all auto demo images (group 1)
            var images = $('.auto-demo-image');

            console.log('Auto demo: Starting overlap animation');

            // Phase 1: Move each image to overlap position relative to their containers
            // Get the actual container width including margins, padding, borders
            var containerWidth = images.first().parent().outerWidth(true);
            console.log('Auto demo: Container width (including margins):', containerWidth);

            images.each(function(index) {
                // Calculate relative movement to overlap all images at center between 2nd and 3rd container
                // index 0: move right 1.5 container widths
                // index 1: move right 0.5 container widths
                // index 2: move left 0.5 container widths
                // index 3: move left 1.5 container widths
                var multiplier = 1.5 - index;
                var targetLeft = multiplier * containerWidth;
                var targetTop = 0; // Keep vertical position aligned

                console.log('Auto demo: Image', index, 'multiplier:', multiplier, 'moving to relative position:', targetLeft, targetTop);

                $(this).animate({
                    left: targetLeft,
                    top: targetTop
                }, 2000, 'swing');
            });

            // Phase 2: Wait at overlap position (4 seconds), then move back to original positions (0,0 relative to containers)
            setTimeout(function() {
                if (!autoDemoRunning) return;

                console.log('Auto demo: Moving back to original positions (0,0)');

                images.each(function(index) {
                    $(this).animate({
                        left: 0,
                        top: 0
                    }, 2000, 'swing', function() {
                        // After animation completes, schedule next cycle
                        if (autoDemoRunning) {
                            setTimeout(runAutoDemoCycle, 2000); // Wait 2 seconds before next cycle
                        }
                    });
                });
            }, 4000); // Stay overlapped for 4 seconds
        }

        function stopAutoDemo() {
            autoDemoRunning = false;
            if (autoDemoInterval) {
                clearInterval(autoDemoInterval);
            }
        }

        // Adjust target area and start auto demo after images load
        $(window).on('load', function() {
            setTimeout(function() {
                adjustTargetArea();
                startAutoDemo(); // Start the automatic overlap demo
            }, 100);
        });

        // é‡ç½®æ—‹è½¬åœ†ç›˜çš„æŒ‰é’®é€»è¾‘
        $('.reset-all-rot-hidden').click(function () {
            $('.rot_hidden_disk').each(function () {
                // åœæ­¢åŠ¨ç”»ï¼ˆå¦‚æœæœ‰ï¼‰å¹¶é‡ç½®è§’åº¦
                $(this).removeClass('flip_image_animated');
                $(this).css({
                    'transform': 'rotate(0deg)',
                    'transition': 'transform 1s'
                });

                // 1ç§’åæ¸…é™¤ transition ä»¥ä¾¿åç»­æ‰‹åŠ¨æ—‹è½¬é¡ºç•…
                setTimeout(() => {
                    $(this).css('transition', '');
                }, 1000);
            });
        });

        // === Hybrid Image Gallery Logic ===

        // 1. å®šä¹‰å›¾ç‰‡æ•°æ®
        const hybridData = [
            {
                src: "./static/images/hybrid_dog_cat.jpg",
                near: "Up close: It's a DOG ğŸ¶",
                far: "From afar: It's a CAT ğŸ±"
            },
            {
                src: "./static/images/hybrid_forest_snow.jpg",
                near: "Up close: A lush FOREST ğŸŒ²",
                far: "From afar: A snowy MOUNTAIN ğŸ”ï¸"
            },
            {
                src: "./static/images/hybrid_forest_street.jpg",
                near: "Up close: A forest PATH ğŸƒ",
                far: "From afar: A city STREET ğŸ™ï¸"
            },
            {
                src: "./static/images/hybrid_smile.jpg",
                near: "Up close: A SERIOUS face ğŸ˜",
                far: "From afar: A SMILING face ğŸ™‚"
            }
        ];

        let currentHybridIndex = 0;
        let hybridInterval;

        // åˆå§‹åŒ–ç”»å»Š
        function initHybridGallery() {
            const thumbList = $('#hybrid-thumb-list');

            // ç”Ÿæˆç¼©ç•¥å›¾
            hybridData.forEach((item, index) => {
                const thumb = $('<img>')
                    .attr('src', item.src)
                    .addClass('hybrid-thumb')
                    .on('click', function() {
                        // ç‚¹å‡»ç¼©ç•¥å›¾æ‰‹åŠ¨åˆ‡æ¢
                        stopHybridAnimation();
                        runHybridCycle(index);
                    });
                thumbList.append(thumb);
            });

            // å¼€å§‹ç¬¬ä¸€ä¸ªå¾ªç¯
            runHybridCycle(0);
        }

        function runHybridCycle(index) {
            currentHybridIndex = index;
            const data = hybridData[index];
            const mainImg = $('#hybrid-main-img');
            const caption = $('#hybrid-dynamic-caption');
            const thumbs = $('.hybrid-thumb');

            // 1. æ›´æ–°ç¼©ç•¥å›¾é«˜äº®
            thumbs.removeClass('active');
            thumbs.eq(index).addClass('active');

            // 2. åˆ‡æ¢å›¾ç‰‡æº (å…ˆè®¾ä¸ºä¸é€æ˜åº¦0ä»¥é˜²é—ªçƒï¼Œè¿™é‡Œç®€åŒ–ç›´æ¥åˆ‡æ¢)
            mainImg.attr('src', data.src);

            // === åŠ¨ç”»æµç¨‹ ===

            // é˜¶æ®µ 1: è¿‘çœ‹ (Near) - æŒç»­ 3.5ç§’
            // ç¡®ä¿å›¾ç‰‡æ˜¯å¤§çš„
            mainImg.removeClass('view-far').addClass('view-near');
            caption.html(data.near).css('opacity', 1);

            // æ¸…é™¤æ—§çš„å®šæ—¶å™¨ï¼Œé˜²æ­¢å†²çª
            if (hybridInterval) clearTimeout(hybridInterval);

            // é˜¶æ®µ 2: å˜è¿œ (Transition to Far)
            hybridInterval = setTimeout(() => {
                mainImg.removeClass('view-near').addClass('view-far');
                caption.css('opacity', 0); // åˆ‡æ¢æ–‡å­—æ—¶å…ˆéšè—ä¸€ä¸‹

                // ç¨å¾®å»¶è¿Ÿä¸€ç‚¹æ”¹å˜æ–‡å­—ï¼Œè®©æ–‡å­—å‡ºç°æ—¶å·²ç»åœ¨å˜å°äº†
                setTimeout(() => {
                    caption.html(data.far).css('opacity', 1);
                }, 500);

                // é˜¶æ®µ 3: å‡†å¤‡ä¸‹ä¸€å¼ 
                setTimeout(() => {
                    let nextIndex = (currentHybridIndex + 1) % hybridData.length;
                    runHybridCycle(nextIndex);
                }, 4000); // è¿œçœ‹ä¿æŒ 4 ç§’ï¼Œç„¶ååˆ‡æ¢ä¸‹ä¸€å¼ 

            }, 3500); // è¿‘çœ‹ä¿æŒ 3.5 ç§’
        }

        function stopHybridAnimation() {
            if (hybridInterval) clearTimeout(hybridInterval);
        }

        // å¯åŠ¨
        initHybridGallery();

        // === Manual Interaction Logic ===

        // å®šä¹‰å…¨å±€å‡½æ•°ä»¥ä¾¿ HTML onclick å¯ä»¥è°ƒç”¨ (æŒ‚è½½åˆ° window å¯¹è±¡)
        window.selectManualImage = function(index) {
            // 1. æ›´æ–°æŒ‰é’®æ ·å¼
            $('.manual-selector-btn').removeClass('is-active');
            $('.manual-selector-btn').eq(index).addClass('is-active');

            // 2. æ›´æ–°å›¾ç‰‡æº (ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„ hybridData)
            const imgData = hybridData[index];
            $('#manual-hybrid-img').attr('src', imgData.src);

            // 3. é‡ç½®æ»‘å—åˆ° 100%
            $('#scale-slider').val(100);
            updateManualScale(100);
        };

        window.updateManualScale = function(val) {
            const scale = val / 100;
            const img = $('#manual-hybrid-img');

            // æ›´æ–°æ–‡å­—æ˜¾ç¤º
            $('#scale-value').text(val);

            // åº”ç”¨ç¼©æ”¾
            // æ³¨æ„ï¼šå½“ç¼©æ”¾å¾ˆå°æ—¶ (Scale < 0.3)ï¼Œæˆ‘ä»¬åŠ ä¸€ç‚¹å¾®å¼±çš„æ¨¡ç³Š (0.5px)
            // è¿™ç¬¦åˆäººçœ¼åœ¨çœ‹è¿œå¤„ç‰©ä½“æ—¶é«˜é¢‘ç»†èŠ‚ä¸¢å¤±çš„ç‰©ç†è§„å¾‹ï¼Œä¹Ÿèƒ½é˜²æ­¢åƒç´ æ··å (aliasing)
            let blurAmount = 0;
            if (scale < 0.3) {
                blurAmount = 0.5 * (1 - (scale / 0.3)); // ç®€å•çš„çº¿æ€§è¿‡æ¸¡
            }

            img.css({
                'transform': `scale(${scale})`,
                'filter': `blur(${blurAmount}px)`
            });
        };

    });
  </script>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
</head>
<body>

<!-- <nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://keunhong.com">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a>

      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          More Research
        </a>
        <div class="navbar-dropdown">
          <a class="navbar-item" href="https://hypernerf.github.io">
            HyperNeRF
          </a>
          <a class="navbar-item" href="https://nerfies.github.io">
            Nerfies
          </a>
          <a class="navbar-item" href="https://latentfusion.github.io">
            LatentFusion
          </a>
          <a class="navbar-item" href="https://photoshape.github.io">
            PhotoShape
          </a>
        </div>
      </div>
    </div>

  </div>
</nav> -->


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">Creating Visual Cognitive Illusions</h1>
          <h2 class="subtitle is-3 has-text-centered">2025 Fall PKU Computer Vision Final Project</h2>
          <div class="is-size-5 publication-authors">
            <span class="author-block">
              <a href="https://smallyang688.github.io/">Zihan Yang</a><sup>1</sup>,</span>
            <span class="author-block">
              Yuming Fang<sup>1</sup>,</span>
            <span class="author-block">
              Yueran Wang<sup>2</sup>
            </span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block"><sup>1</sup>Peking University, School of Electronics Engineering and Computer Science,</span>
            <span class="author-block"><sup>2</sup>Peking University, School of Mathematical Sciences</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/smallyang688/Creating-Visual-Cognitive-Illusions"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
              <span class="link-block">
                <a href="./report/report.pdf" target="_blank"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                  </a>
              </span>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<section class="section" style="padding-top: 0.25rem;">
  <div class="container is-max-desktop">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
        </div>
      </div>
    </div>
    <!--/ Abstract. -->

    <!-- Interactive Demos. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Interactive Demos</h2>


        <!-- Flip Illusion Demo -->
        <h3 class="title is-4">Flip Illusion</h3>
        <p><strong class="highlight">Click and drag to rotate, double-click to reset!</strong></p>
        <div style="text-align: center; margin: 20px 0;">
          <button class="reset-all-flip-images-button button is-primary">Reset All Rotations</button>
        </div>
        <div class="columns is-centered">
          <div class="column is-one-third">
            <div class="image-container" style="text-align: center;">
              <img src="./static/images/flip1.jpg" class="flip_image flip_image_animated glow-hover-element" style="max-width: 200px; max-height: 200px;">
            </div>
            <div class="caption" style="text-align: center; margin-top: 10px;">
              giraffe/penguin
            </div>
          </div>
          <div class="column is-one-third">
            <div class="image-container" style="text-align: center;">
              <img src="./static/images/flip2.jpg" class="flip_image flip_image_animated glow-hover-element" style="max-width: 200px; max-height: 200px;">
            </div>
            <div class="caption" style="text-align: center; margin-top: 10px;">
              ship/ship
            </div>
          </div>
          <div class="column is-one-third">
            <div class="image-container" style="text-align: center;">
              <img src="./static/images/flip3.jpg" class="flip_image flip_image_animated glow-hover-element" style="max-width: 200px; max-height: 200px;">
            </div>
            <div class="caption" style="text-align: center; margin-top: 10px;">
              dress/dress
            </div>
          </div>
        </div>

        <!-- Rotation Overlay Demo -->
        <h3 class="title is-4" style="margin-top: 2rem;">Rotation Overlay Illusion</h3>
        <p><strong class="highlight">Click and drag to rotate the top image. Watch how the combined image changes!</strong></p>
        <div style="text-align: center; margin: 20px 0;">
          <button class="reset-all-rotaters-button button is-primary" style="margin-right: 10px;">Reset All Positions</button>
          <button class="rotation-overlay-pause-button button is-warning">Pause Animation</button>
        </div>
        <div class="columns is-centered" style="gap: 40px;">
          <div class="column is-one-third">
            <div class="rot-image-container" style="filter: brightness(200%);">
              <img src="./static/images/rot_base_1.png" class="rot_image_size">
              <img src="./static/images/rot_overlay_1.png" class="rot_image_size quad-rotating-image draggable-image glow-hover-element">
            </div>
          </div>
          <div class="column is-one-third">
            <div class="rot-image-container" style="filter: brightness(150%);">
              <img src="./static/images/rot_base_2.png" class="rot_image_size">
              <img src="./static/images/rot_overlay_2.png" class="rot_image_size quad-rotating-image draggable-image glow-hover-element">
            </div>
          </div>
          <div class="column is-one-third">
            <div class="rot-image-container" style="filter: brightness(180%);">
              <img src="./static/images/rot_base_3.png" class="rot_image_size">
              <img src="./static/images/rot_overlay_3.png" class="rot_image_size quad-rotating-image draggable-image glow-hover-element">
            </div>
          </div>
        </div>

        <!-- Hidden Overlay Demo -->
        <h3 class="title is-4" style="margin-top: 2rem;">Hidden Overlay Illusion</h3>
        <p style="text-align: center; margin-bottom: 1rem; color: #666;"><strong class="highlight">Drag multiple transparent images together to reveal a hidden pattern underneath!</strong></p>

        <!-- Reset button moved here -->
        <div style="text-align: center; margin-bottom: 2rem;">
          <button class="reset-all-hidden-characters button is-primary">Reset All Positions</button>
        </div>

        <div class="demo-groups">
        <!-- Group 1: Automatic overlap demo -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area-auto" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap1.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap2.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap3.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlap4.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element auto-demo-image">
            </div>
          </div>
        </div>

        <!-- Group 2: Manual drag demo -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <!-- Glow effect box -->
          <div class="glow-effect" id="glow-effect"></div>

          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay1.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay2.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay3.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay4.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
          </div>
        </div>

        <!-- Group 3: New geometric patterns -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area-geo" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay5.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay6.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay7.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay8.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
          </div>
        </div>

        <!-- Group 4: Additional patterns -->
        <div class="lightbox" style="padding: 20px; margin: 20px auto; width: 1200px; position: relative;">
          <!-- Target area rectangle - shows where images should overlap -->
          <div class="target-area" id="target-area-group4" style="width: 1120px; height: 260px; left: 40px; top: 20px;"></div>
          <div class="row">
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay9.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay10.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay11.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
            <div class="hidden-character-image-container">
              <img src="./static/images/overlay12.png" class="draggable-image quad-overlay hidden-character-image glow-hover-element">
            </div>
          </div>
        </div>

        <div class="caption" style="text-align: center; margin-top: 10px;">
          Scan it!
        </div>

        </div>
      </div>
    </div>
    <!--/ Interactive Demos. -->
  </div>
</section>

<!-- Rotational Hidden Overlay Demo -->
<section class="section">
  <div class="container is-max-desktop has-text-centered">
    <h3 class="title is-4" style="margin-top: 2rem;">Rotational Hidden Overlay</h3>
    <p><strong class="highlight">Drag to rotate the top disk. Align it to the correct angle to reveal the secret!</strong></p>

    <div style="margin: 20px 0;">
      <button class="reset-all-rot-hidden button is-primary">Reset All Disks</button>
    </div>

    <div class="columns is-centered is-mobile" style="gap: 20px;">

      <div class="column is-one-third" style="padding: 10px;">
        <div class="rot-hidden-outer-container" style="width: 280px; flex-direction: column; align-items: center; display: flex;">
          <div class="rot-hidden-container">
            <img src="./static/images/rot_hidden_base_1.png" class="rot-base-img">
            <img src="./static/images/rot_hidden_overlay_1.png" class="rot_hidden_disk flip_image glow-hover-element">
          </div>
          <div class="caption" style="text-align: center; margin-top: 15px; width: 100%;">
            You can find three angles that reveal 'PKU', 'EECS', and 'SMS' respectively.
          </div>
        </div>
      </div>

      <div class="column is-one-third" style="padding: 10px;">
        <div class="rot-hidden-outer-container" style="width: 280px; flex-direction: column; align-items: center; display: flex;">
          <div class="rot-hidden-container">
            <img src="./static/images/rot_hidden_base_2.png" class="rot-base-img">
            <img src="./static/images/rot_hidden_overlay_2.png" class="rot_hidden_disk flip_image glow-hover-element">
          </div>
          <div class="caption" style="text-align: center; margin-top: 15px; width: 100%;">
            You can find one angle that reveals a heart and the letters 'LOVE'.
          </div>
        </div>
      </div>

      <div class="column is-one-third" style="padding: 10px;">
        <div class="rot-hidden-outer-container" style="width: 280px; flex-direction: column; align-items: center; display: flex;">
          <div class="rot-hidden-container">
            <img src="./static/images/rot_hidden_base_3.png" class="rot-base-img">
            <img src="./static/images/rot_hidden_overlay_3.png" class="rot_hidden_disk flip_image glow-hover-element">
          </div>
          <div class="caption" style="text-align: center; margin-top: 15px; width: 100%;">
            You can find one angle that reveals a cup.
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop has-text-centered">

    <h2 class="title is-3">Distance-Dependent Spectral Hybridization</h2>
    <p><strong class="highlight">Dynamic Distance Simulation</strong></p>
    <p style="font-size: 0.9em; margin-bottom: 20px; color: #666;">
        (High-frequency details dominate up close, while low-frequency shapes emerge from afar.)
    </p>

    <div class="columns is-centered">
      <div class="column is-full">
        <div class="hybrid-gallery-container">
            <div class="hybrid-thumbnails" id="hybrid-thumb-list"></div>
            <div class="hybrid-stage">
                <img src="" id="hybrid-main-img" class="hybrid-stage-img view-near">
                <div class="hybrid-caption-box" id="hybrid-dynamic-caption">
                    Loading...
                </div>
            </div>
        </div>
      </div>
    </div>

    <div class="manual-control-box">
        <h3 class="title is-4">Interactive Verification</h3>
        <p style="margin-bottom: 1rem; max-width: 800px; margin-left: auto; margin-right: auto; line-height: 1.6;">
            <strong>Note:</strong> The animation above involves no visual tricks or editing; it strictly simulates changing viewing distance by resizing the image.
            You can verify this scale-dependent perception yourself by selecting an image and dragging the slider below.
        </p>

        <div class="buttons has-addons is-centered" style="margin-bottom: 20px;">
            <button class="button is-rounded manual-selector-btn is-active" onclick="selectManualImage(0)">Dog / Cat</button>
            <button class="button is-rounded manual-selector-btn" onclick="selectManualImage(1)">Forest / Mountain</button>
            <button class="button is-rounded manual-selector-btn" onclick="selectManualImage(2)">Forest / Street</button>
            <button class="button is-rounded manual-selector-btn" onclick="selectManualImage(3)">Serious / Smile</button>
        </div>

        <div class="manual-slider-container">
            <span class="icon"><i class="fas fa-search-minus"></i></span> <input type="range" min="5" max="100" value="100" class="hybrid-slider" id="scale-slider" oninput="updateManualScale(this.value)">
            <span class="icon"><i class="fas fa-search-plus"></i></span> </div>
        <div style="font-size: 0.8rem; color: #888; margin-bottom: 10px;">
            Current Scale: <span id="scale-value">100</span>%
        </div>

        <div class="manual-image-container">
            <img src="./static/images/hybrid_dog_cat.jpg" id="manual-hybrid-img">
        </div>
    </div>

  </div>
</section>

<section class="section">
  <div class="container is-max-desktop has-text-centered">
    <h2 class="title is-3">Orthogonal Voxel Projection Synthesis</h2>
    <p style="margin-bottom: 2rem;">
      <strong class="highlight">A 3D voxel structure that projects different semantic objects from three orthogonal views.</strong>
    </p>

    <div class="columns is-centered">
      <div class="column is-full">
        <div id="voxel-container" style="width: 100%; height: 500px; background-color: #f0f0f0; border-radius: 10px; position: relative; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            <div id="loading-text" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666;">Loading 3D Model...</div>
        </div>
        <div class="caption" style="margin-top: 10px;">
          Interactive 3D Viewer (Click and drag to rotate, scroll to zoom)
        </div>
      </div>
    </div>

    <h4 class="title is-5" style="margin-top: 2rem;">Orthogonal Views</h4>
    <div class="columns is-centered is-mobile" style="gap: 20px;">

      <div class="column is-one-third">
        <div class="image-container" style="border: 1px solid #ddd; padding: 5px; background: white; border-radius: 8px;">
          <img src="./static/images/butterfly.png" style="width: 100%; height: auto; display: block;">
        </div>
        <div class="caption" style="margin-top: 10px; font-weight: bold;">
          Front View: Butterfly
        </div>
      </div>

      <div class="column is-one-third">
        <div class="image-container" style="border: 1px solid #ddd; padding: 5px; background: white; border-radius: 8px;">
           <img src="./static/images/tree.png" style="width: 100%; height: auto; display: block;">
        </div>
        <div class="caption" style="margin-top: 10px; font-weight: bold;">
          Side View: Tree
        </div>
      </div>

      <div class="column is-one-third">
        <div class="image-container" style="border: 1px solid #ddd; padding: 5px; background: white; border-radius: 8px;">
           <img src="./static/images/apple.png" style="width: 100%; height: auto; display: block;">
        </div>
        <div class="caption" style="margin-top: 10px; font-weight: bold;">
          Top View: Apple
        </div>
      </div>

    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop has-text-centered">

    <h2 class="title is-3">Differentiable Cylindrical Anamorphosis</h2>

    <div class="columns is-centered is-vcentered">

      <div class="column has-text-centered">
        <div style="display: inline-block;">
          <video
            src="./static/videos/lookingglass_demo.mp4"
            autoplay loop muted playsinline
            style="height: 300px; width: auto; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
          </video>
          <div class="caption" style="margin-top: 8px; font-weight: bold;">
            Top-Left: Official Demo (LookingGlass)
          </div>
        </div>
      </div>

      <div class="column has-text-centered">
        <div style="display: inline-block;">
          <img
            src="./static/images/cylinder_real_fail.jpg"
            style="height: 300px; width: auto; border-radius: 10px; object-fit: contain; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
          <div class="caption" style="margin-top: 8px; font-weight: bold;">
            Top-Right: Real-world Experiment Gap
          </div>
        </div>
      </div>

    </div>

    <div class="columns is-centered" style="margin-top: 20px;">

      <div class="column is-half has-text-centered">
        <figure class="image">
           <img src="./static/images/cylinder_sim_yourname.jpg" style="border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
        </figure>
        <div class="caption" style="margin-top: 8px;">
           <strong>Bottom-Left:</strong> Simulation ("Your Name")
        </div>
      </div>

      <div class="column is-half has-text-centered">
        <figure class="image">
           <img src="./static/images/cylinder_sim_tothemoon.jpg" style="border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
        </figure>
        <div class="caption" style="margin-top: 8px;">
           <strong>Bottom-Right:</strong> Simulation ("To The Moon")
        </div>
      </div>

    </div>

    <div class="content has-text-justified" style="margin-top: 30px; background-color: #f5f5f5; padding: 20px; border-radius: 10px;">
      <p>
        We were deeply inspired by the impressive visual effects presented in
        <strong><em>LookingGlass: Generative Anamorphoses via Laplacian Pyramid Warping</em></strong>
        (Chang et al., CVPR 2025 Oral). Since the official codebase was unavailable, we attempted to reproduce
        the differentiable cylindrical anamorphosis effect within our own framework.
      </p>
      <p>
        Our computer simulations yielded promising results, as shown in the bottom row.
        The <strong>bottom-left</strong> image demonstrates a generated example where the flat pattern appears as a
        <em>starry sky</em> (left sub-panel), yet reveals the iconic hand-holding scene from the movie
        <em>Your Name</em> when reflected on a cylinder (middle sub-panel), matching the target poster (right sub-panel).
        Similarly, the <strong>bottom-right</strong> image presents another example where a flattened <em>monster</em>
        pattern transforms into the silhouette of the heroine from the game <em>To the Moon</em>.
      </p>
      <p>
        However, the <strong>top-right</strong> image illustrates our attempt to replicate this in the physical world
        by printing the generated pattern and observing it through a reflective cylinder. The resulting reflection is
        indistinct (compared to the official demo in the <strong>top-left</strong>), highlighting a significant
        <strong>sim-to-real gap</strong> in our current implementation that requires further refinement in material modeling and alignment.
      </p>
    </div>

  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <h2 class="title is-3 has-text-centered">Experimental Evaluation</h2>
    <div class="content has-text-justified">
      <p>
        To ensure the quality of our generated illusions, we designed an automated pipeline consisting of two stages:
        <strong>Automated Generation</strong> using Diffusion Models (DeepFloyd IF / SD v1.4) and
        <strong>Intelligent Evaluation</strong> using Vision Language Models (Qwen3-VL-4B-Instruct).
      </p>
      <p>
        We implemented a <strong>"blind test"</strong> strategy where the VLM evaluates the generated images without knowing the target words beforehand.
        This ensures the objectivity of the scores.
      </p>
    </div>

    <h3 class="title is-4">Qualitative Comparison</h3>
    <p class="content has-text-centered">
      We generated thousands of samples. Below is a comparison showing the disparity in generation quality.
      Higher VLM scores indicate clearer text legibility and better illusion consistency.
    </p>

    <div class="columns is-centered has-text-centered">
      <div class="column is-one-third">
        <div class="box">
          <figure class="image is-1by1">
            <img src="./static/images/score_0.png" alt="Score 0 Sample" style="object-fit: contain;">
          </figure>
          <p class="subtitle is-6 mt-2 has-text-danger"><strong>Score: 0</strong></p>
          <p class="is-size-7">Complete failure in text formation.</p>
        </div>
      </div>

      <div class="column is-one-third">
        <div class="box">
          <figure class="image is-1by1">
            <img src="./static/images/score_5.png" alt="Score 5 Sample" style="object-fit: contain;">
          </figure>
          <p class="subtitle is-6 mt-2 has-text-warning-dark"><strong>Score: 5</strong></p>
          <p class="is-size-7">Recognizable but lacks consistency.</p>
        </div>
      </div>

      <div class="column is-one-third">
        <div class="box">
          <figure class="image is-1by1">
            <img src="./static/images/score_9.png" alt="Score 9 Sample" style="object-fit: contain;">
          </figure>
          <p class="subtitle is-6 mt-2 has-text-success"><strong>Score: 9</strong></p>
          <p class="is-size-7">High legibility and perfect semantic alignment.</p>
        </div>
      </div>
    </div>

    <h3 class="title is-4 mt-5">Quantitative Analysis</h3>
    <p class="content">
      We generated <strong>3,333</strong> candidate images for the (EECS, SMS) word pair. The table below shows the score distribution evaluated by Qwen3-VL.
      As observed, generating high-quality ambigrams is challenging, with only <strong>~6%</strong> of samples achieving a score of 8.0 or higher.
    </p>

    <div class="table-container">
      <table class="table is-bordered is-striped is-narrow is-hoverable is-fullwidth has-text-centered">
        <thead>
          <tr class="is-selected">
            <th>VLM Score</th>
            <th>Count</th>
            <th>Percentage</th>
            <th>VLM Score</th>
            <th>Count</th>
            <th>Percentage</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>0.0</td><td>1,171</td><td>35.1%</td>  <td>5.0</td><td>68</td><td>2.0%</td></tr>
          <tr><td>0.5</td><td>36</td><td>1.1%</td>      <td>5.5</td><td>15</td><td>0.5%</td></tr>
          <tr><td>1.0</td><td>143</td><td>4.3%</td>     <td>6.0</td><td>106</td><td>3.2%</td></tr>
          <tr><td>1.5</td><td>50</td><td>1.5%</td>      <td>6.5</td><td>28</td><td>0.8%</td></tr>
          <tr><td>2.0</td><td>77</td><td>2.3%</td>      <td>7.0</td><td>193</td><td>5.8%</td></tr>
          <tr><td>2.5</td><td>26</td><td>0.8%</td>      <td>7.5</td><td>666</td><td>20.0%</td></tr>
          <tr><td>3.0</td><td>75</td><td>2.3%</td>      <td><strong>8.0</strong></td><td>462</td><td>13.9%</td></tr>
          <tr><td>3.5</td><td>15</td><td>0.5%</td>      <td><strong>8.5</strong></td><td>181</td><td>5.4%</td></tr>
          <tr><td>4.0</td><td>58</td><td>1.7%</td>      <td><strong>9.0</strong></td><td>4</td><td>0.1%</td></tr>
          <tr><td>4.5</td><td>13</td><td>0.4%</td>      <td colspan="3" class="has-background-grey-lighter"></td></tr>
        </tbody>
      </table>
    </div>

  </div>
</section>

<section class="section" id="BibTeX">
  <div class="container is-max-desktop content">
    <h2 class="title">BibTeX</h2>
    <pre><code>@article{diffusion illusion
  author    = {Zihan Yang, Yuming Fang, Yueran Wang},
  title     = {Creating Visual Cognitive Illusions},
  journal   = {PKU Computer Vision Final Project},
  year      = {2025},
}</code></pre>
  </div>
</section>


<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <a class="icon-link"
         href="https://arxiv.org/pdf/2312.03817">
        <i class="fas fa-file-pdf"></i>
      </a>
      <a class="icon-link" href="https://github.com/RyannDaGreat/Diffusion-Illusions" class="external-link">
        <i class="fab fa-github"></i>
      </a>
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>
          <p>
            This means you are free to borrow the <a
              href="https://github.com/nerfies/nerfies.github.io">source code</a> of this website,
            we just ask that you link back to this page in the footer.
            Please remember to remove the analytics code included in the header of the website which
            you do not want on your website.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

<script type="module">
    import * as THREE from 'three';
    // å¼•å…¥ ArcballControls (å…¨å‘æ—‹è½¬æ§åˆ¶å™¨)
    import { ArcballControls } from 'three/addons/controls/ArcballControls.js';
    import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';

    function init3DViewer() {
        const container = document.getElementById('voxel-container');
        if (!container) return;

        // 1. åˆ›å»ºåœºæ™¯
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0); // æµ…ç°è‰²èƒŒæ™¯

        // 2. åˆ›å»ºç›¸æœº
        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(50, 50, 50); // è®¾ç½®ç›¸æœºåˆå§‹ä½ç½®

        // 3. åˆ›å»ºæ¸²æŸ“å™¨
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        // 4. æ·»åŠ æ§åˆ¶å™¨ (æ”¹ä¸º ArcballControls ä»¥æ¶ˆé™¤æ­»è§’)
        // æ³¨æ„ï¼šArcballControls éœ€è¦ä¼ å…¥ sceneï¼Œå› ä¸ºå®ƒé»˜è®¤ä¼šå¸¦ä¸€ä¸ªè¾…åŠ©åœˆ(Gizmo)
        const controls = new ArcballControls(camera, renderer.domElement, scene);

        // éšè—é»˜è®¤çš„å½©è‰²æ§åˆ¶åœˆ (Gizmo)ï¼Œä¿æŒç”»é¢å¹²å‡€
        controls.setGizmosVisible(false);

        // è®¾ç½®é˜»å°¼ï¼Œè®©æ—‹è½¬æœ‰æƒ¯æ€§ï¼Œæ‰‹æ„Ÿæ›´å¥½
        controls.enableAnimations = true;
        controls.dampingFactor = 10; // Arcball çš„é˜»å°¼ç³»æ•°ç®—æ³•ä¸åŒï¼Œé€šå¸¸è¦åœ¨ 5-20 ä¹‹é—´
        controls.wMax = 12; // æ—‹è½¬çµæ•åº¦é™åˆ¶

        // 5. æ”¹è¿›ç¯å…‰ç³»ç»Ÿ (Studio Lighting)
        // åŠçƒå…‰ï¼šæ¨¡æ‹Ÿå¤©ç©ºå…‰ (ç™½è‰²) å’Œåœ°é¢åå…‰ (æ·±ç°)ï¼Œè¿™èƒ½è®©æ¨¡å‹é˜´å½±éƒ¨åˆ†ä¹Ÿæœ‰ç»†èŠ‚
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
        hemiLight.position.set(0, 20, 0);
        scene.add(hemiLight);

        // ä¸»å…‰æºï¼šå¼ºå…‰ï¼Œåˆ¶é€ é«˜å…‰å’Œé˜´å½±
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
        dirLight.position.set(50, 50, 50); // ä»ä¾§ä¸Šæ–¹æ‰“å…‰
        scene.add(dirLight);

        // è½®å»“å…‰/è¡¥å…‰ï¼šç…§äº®èƒŒé¢ï¼Œé˜²æ­¢æ­»é»‘
        const backLight = new THREE.DirectionalLight(0xffffff, 0.5);
        backLight.position.set(-50, -20, -50);
        scene.add(backLight);

        // 6. åŠ è½½ OBJ æ¨¡å‹
        const loader = new OBJLoader();
        // === è¯·ä¿®æ”¹è¿™é‡Œçš„è·¯å¾„ä¸ºä½ çš„ obj æ–‡ä»¶è·¯å¾„ ===
        loader.load(
            './static/models/voxel.obj',
            function (object) {
                // åŠ è½½æˆåŠŸçš„å›è°ƒ
                const loadingText = document.getElementById('loading-text');
                if (loadingText) loadingText.style.display = 'none';

                // 1. ç»™æ¨¡å‹åŠ ä¸Šæè´¨ (ä¿®æ”¹ä¸ºç™½æ¨¡é£æ ¼)
                object.traverse(function (child) {
                    if (child.isMesh) {
                        // ä½¿ç”¨ Standard æè´¨ï¼Œè¿™ç§æè´¨é…åˆä¸Šé¢çš„ç¯å…‰æ•ˆæœæœ€å¥½
                        child.material = new THREE.MeshStandardMaterial({
                            color: 0xdddddd,  // æµ…ç°è‰² (æ¯”çº¯ç™½å¥½ï¼Œä¸å®¹æ˜“è¿‡æ›)
                            roughness: 0.6,   // ç²—ç³™åº¦ï¼š0.6 åƒç²˜åœŸ/çŸ³è†
                            metalness: 0.1,   // é‡‘å±åº¦ï¼šå¾ˆä½ï¼Œé¿å…åƒé•œå­
                            flatShading: true, // å…³é”®ï¼šä¿ç•™ä½“ç´ çš„æ£±è§’æ„Ÿ
                            side: THREE.DoubleSide
                        });
                    }
                });

                // 2. è®¡ç®—æ¨¡å‹çš„åŒ…å›´ç›’
                const box = new THREE.Box3().setFromObject(object);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());

                // 3. å±…ä¸­æ¨¡å‹ï¼šæŠŠæ¨¡å‹ç§»åŠ¨åˆ°ä¸–ç•Œåæ ‡åŸç‚¹ (0,0,0)
                // é€»è¾‘ï¼šå°†æ¨¡å‹çš„å½“å‰ä½ç½®å‡å»å®ƒçš„ä¸­å¿ƒç‚¹åç§»é‡
                object.position.x = -center.x;
                object.position.y = -center.y;
                object.position.z = -center.z;

                // å°†ä¿®æ­£åçš„æ¨¡å‹æ·»åŠ åˆ°åœºæ™¯
                // æ­¤æ—¶æ¨¡å‹çš„è§†è§‰ä¸­å¿ƒå°±åœ¨ (0,0,0) äº†
                scene.add(object);

                // 4. è‡ªåŠ¨è°ƒæ•´ç›¸æœºè·ç¦» (ä¿®å¤äº†ä¹‹å‰çš„æ•°å­¦é”™è¯¯)
                const maxDim = Math.max(size.x, size.y, size.z);
                const fov = camera.fov * (Math.PI / 180);

                // è®¡ç®—ç›¸æœºè·ç¦»ï¼šè®©æ¨¡å‹æœ€å¤§çš„ä¸€è¾¹åˆšå¥½æ’‘æ»¡è§†é‡
                // å…¬å¼ï¼šdistance = (size / 2) / tan(fov / 2)
                let cameraDist = (maxDim / 2) / Math.tan(fov / 2);

                // ä¹˜ä»¥ä¸€ä¸ªç³»æ•°ç¨å¾®æ‹‰è¿œä¸€ç‚¹ï¼Œç•™ç‚¹è¾¹è·
                cameraDist *= 2.0;

                // è®¾ç½®ç›¸æœºä½ç½®
                camera.position.set(cameraDist, cameraDist, cameraDist);

                // 5. å…³é”®ï¼šç›¸æœºå’Œæ§åˆ¶å™¨éƒ½å¿…é¡»çœ‹å‘åŸç‚¹ (0,0,0)
                // å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ç¬¬3æ­¥æŠŠæ¨¡å‹ç§»åˆ° (0,0,0) äº†
                camera.lookAt(0, 0, 0);
                controls.target.set(0, 0, 0);

                controls.update();
            },
            function (xhr) {
                // åŠ è½½è¿›åº¦
                console.log((xhr.loaded / xhr.total * 100) + '% loaded');
            },
            function (error) {
                // é”™è¯¯å¤„ç†
                console.error('An error happened loading the OBJ:', error);
                const loadingText = document.getElementById('loading-text');
                if (loadingText) loadingText.innerText = 'Error: ' + error.message;
            }
        );

        // 7. åŠ¨ç”»å¾ªç¯
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // 8. çª—å£å¤§å°æ”¹å˜æ—¶è‡ªåŠ¨è°ƒæ•´
        window.addEventListener('resize', onWindowResize, false);
        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
    }

    // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨
    init3DViewer();
</script>

</body>
</html>
